**Брокер сообщений** представляет собой тип построения архитектуры, при котором элементы системы «общаются» друг с другом с помощью посредника. Благодаря его работе происходит снятие нагрузки с веб-сервисов, так как им не приходится заниматься пересылкой сообщений: всю сопутствующую этому процессу работу он берёт на себя.

Можно сказать, что в работе любого брокера сообщений используются две основные сущности: producer (издатель сообщений) и consumer (потребитель/подписчик).

Одна сущность занимается созданием сообщений и отправкой их другой сущности-потребителю. В процессе отправки есть ещё серединная точка, которая представляет собой папку файловой системы, где хранятся сообщения, полученные от продюсера.

Здесь возможны несколько вариантов:

- _Сообщение отправляется напрямую от отправителя к получателю._
    

В этом случае каждое сообщение используется только однократно;

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/c67/a3a/3bc/c67a3a3bc1215b57b0ce0e79ce6876c7.png)

- _Схема публикации/подписки._
    

В рамках этой схемы обмена сообщениями отправитель не знает своих получателей и просто публикует сообщения в определённую тему. Потребители, которые подписаны на эту тему, получают сообщение. Далее на базе этой системы может быть построена работа с распределением задач между подписчиками. То есть выстроена логика работы, когда в одну и ту же тему публикуются сообщения для разных потребителей. Каждый «видит» уникальный маркер своего сообщения и забирает его для исполнения.

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/2cf/7b1/295/2cf7b1295c0ce605db943eb9362010d0.png)

## Для чего нужны брокеры сообщений?

- Для организации связи между отдельными службами, даже если какая-то из них не работает в данный момент. То есть продюсер может отправлять сообщения, несмотря на то, проявляет ли активность потребитель в настоящее время.
    
- За счёт асинхронной обработки задач можно увеличить производительность системы в целом.
    
- Для обеспечения надёжности доставки сообщений: как правило, брокеры обеспечивают механизмы многократной отправки сообщений в тот же момент или через определённое время. Кроме того, обеспечивается соответствующая маршрутизация сообщений, которые не были доставлены.
    

#### Недостатки брокеров сообщений:

- Усложнение системы в целом как таковой, так как в ней появляется ещё один элемент. Кроме того, возникает зависимость от надёжности распределённой сети, а также потенциальная возможность возникновения проблем из-за потребности в непротиворечивости данных, так как некоторые элементы системы могут обладать неактуальными данными.
    
- Из-за асинхронной работы всей системы, а также её распределённого характера могут возникать ошибки, выяснение сути которых может стать непростой задачей.
    
- Освоение подобных систем является не самым простым вопросом и может занять существенное время.
    

#### Когда брокеры сообщений могут быть полезны:

- Если в рамках вашей системы есть действия, которые требуют для своего выполнения много времени и потребляют много ресурсов, при этом они не требуют немедленного результата.
    

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/28e/71a/c5f/28e71ac5ff1a2c6e86cb1d139f3c4920.png)

- Микросервисы: если ваша система достаточно сложна и состоит из отдельных сервисов, то для их координации можно использовать брокер сообщений, который в этом случае будет выступать в роли как бы центрального роутера. Каждый сервис подписывается только на свой тип сообщений, выстраивается определённая логика их обработки.
    

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/b78/06e/1c7/b7806e1c76a35bcc0aa6039b50955783.png)

- Мобильные приложения: здесь возможен вариант с задействованием push-уведомлений, когда множество смартфонов с установленным приложением подписаны на определённую тему. Если в ней публикуется какая-либо новость, то подписанный смартфон выводит уведомление.
    
- Транзакционные системы: если какое-то действие системы состоит из множества отдельных этапов, каждый из которых выполняется отдельным элементом системы, то в этом случае брокер сообщений может выступить в роли своеобразной «доски уведомлений». Каждый сервис отписывается после того, как его этап общей задачи был выполнен. После этого в работу вступает следующий сервис, обрабатывающий, соответственно, следующий этап общей задачи.
    

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/2e8/6b0/e37/2e86b0e37f685f220edd9a287cea7192.png)

#### Какие есть брокеры сообщений?

Apache Kafka, Redis, RabbitMQ, Platform V Corax